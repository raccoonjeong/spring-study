# 2. express 서버 세팅하기

## 1. express 프로젝트 만들기

### 새 프로젝트 폴더 생성하기

```bash
// server라는 새 폴더 생성
mkdir server

// 현재 경로 내 파일,폴더들 살펴보기
ls
ls -al

// server 폴더로 이동
cd ./server
```

### Node 초기화

```
npm init -y
```

### express, cors 설치

```bash
npm i express cors
```

### nodemon 설치

```bash
npm i -D nodemon
```

### package.json에 스크립트 추가

```json
 "scripts": {
    "dev": "nodemon server.js",
    "start": "node server.js"
  }
```

- dev 명령어 시 노드맨으로 실행 (개발용)
- start 명령어 시 node로 실행 (배포용)

### type module 추가하기

```json
"type": "module",
```

코드 안에서 ES Module 문법(import/export) 쓰려면 필요. 없으면 경고(warning) 뜸.

### 최종 package.json

```json
{
  "name": "server",
  "version": "1.0.0",
  "main": "index.js",
  "type": "module",
  "scripts": {
    "dev": "nodemon server.js",
    "start": "node server.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "description": "",
  "dependencies": {
    "cors": "^2.8.5",
    "express": "^5.1.0"
  },
  "devDependencies": {
    "nodemon": "^3.1.10"
  }
}
```

- 개발할 때는 **npm run dev** : nodemon이 코드 변경 시 자동 재시작
- 배포할 때는 **npm start** : node로 실행 (안정적)

## 2. server.js 파일 만들기

### 실행하기 : npm run dev

```js
import express from "express";
import cors from "cors";

const app = express();
const PORT = process.env.PORT || 4000;

// 헬스 체크
app.get("/", (req, res) => {
  res.send("Express posts API is running");
});

app.listen(PORT, () => {
  console.log(`Server running at http://localhost:${PORT}`);
});
```

"Express posts API is running" 라고 뜨면 성공!

## 3. 포스트 목록 보여주기 (GET)

```js
import express from "express";
import cors from "cors";

const app = express();
const PORT = process.env.PORT || 4000;

// 미들웨어
app.use(cors());
app.use(express.json());

// 임시 데이터 (메모리 DB)
let posts = [
  {
    id: 1,
    title: "Hello Express",
    content: "첫 번째 글입니다.",
    category: "js",
  },
  {
    id: 2,
    title: "리액트에서 fetch를 써보자",
    content: "두 번째 글입니다.",
    category: "react",
  },
];
let nextId = 3;

// 목록 조회
app.get("/posts", (req, res) => {
  res.json(posts);
});

// 헬스 체크
app.get("/", (req, res) => {
  res.send("Express posts API is running");
});

app.listen(PORT, () => {
  console.log(`Server running at http://localhost:${PORT}`);
});
```

## 4. 포스트 상세보기 (GET)

```js
// 상세보기
app.get("/posts/:id", (req, res) => {
  const id = Number(req.params.id);
  const post = posts.find((p) => p.id === id);
  if (!post)
    return res.status(404).json({ message: "해당하는 포스트가 없습니다." });
  res.json(post);
});
```

## 5. 포스트 추가하기 (POST)

```js
// 새로 추가하기
app.post("/posts", (req, res) => {
  const { title, content, category } = req.body;
  if (!title || !content || !category) {
    return res.status(400).json({ message: "title과 body는 필수입니다." });
  }
  const newPost = { id: nextId++, title, content, category };
  posts.unshift(newPost);
  res.status(201).json(newPost);
});
```

### unshift()

unshift는 배열 맨 앞에 요소를 추가하는 메서드입니다.

#### 기본 사용

```js
array.unshift(element1, element2, ...);
```

- array 맨 앞에 요소들을 추가

- 반환값은 추가된 후 배열의 길이

#### 예제

```js
let arr = [2, 3, 4];

arr.unshift(1);
console.log(arr); // [1, 2, 3, 4]

arr.unshift(-2, -1, 0);
console.log(arr); // [-2, -1, 0, 1, 2, 3, 4]
```

## 6. 포스트 삭제하기 (DELETE)

```js
// 삭제
app.delete("/posts/:id", (req, res) => {
  const id = Number(req.params.id);
  const idx = posts.findIndex((p) => p.id === id);
  if (idx === -1) return res.status(404).json({ message: "Post not found" });
  const removed = posts.splice(idx, 1)[0];
  res.json({ message: "Deleted", post: removed });
});
```

### splice()

```js
posts.splice(idx, 1);
```

- 배열 posts에서 인덱스 idx의 요소를 1개 잘라내라
- 반환값은 [잘라낸 요소] 형태의 배열

```js
const removed = posts.splice(idx, 1)[0];
```

- 그 반환된 배열의 첫 번째 요소만 꺼내서 removed에 담음

즉, 배열에서 요소를 제거 + 반환 동시에 하는 간단한 패턴입니다.

```js
let arr = ["a", "b", "c"];
const removed = arr.splice(1, 1)[0];
console.log(removed); // "b"
console.log(arr); // ["a", "c"]
```

## 7. 포스트 수정하기 (PUT)

전체 수정 (PUT): 모든 필드를 교체

```js
app.put("/posts/:id", (req, res) => {
  const id = Number(req.params.id);
  const idx = posts.findIndex((p) => p.id === id);
  if (idx === -1) return res.status(404).json({ message: "Post not found" });

  const { title, content, category } = req.body || {};
  if (!title || !content || !category) {
    return res
      .status(400)
      .json({ message: "title, content, category 모두 필요합니다." });
  }

  const updated = { id, title, content, category };
  posts[idx] = updated;
  res.json(updated);
});
```

## 8. 포스트 수정하기 (PATCH)

부분 수정 (PATCH): 전달된 필드만 교체

```js
app.patch("/posts/:id", (req, res) => {
  const id = Number(req.params.id);
  const post = posts.find((p) => p.id === id);
  if (!post) return res.status(404).json({ message: "Post not found" });

  const { title, content, category } = req.body || {};
  if (title !== undefined) post.title = title;
  if (content !== undefined) post.content = content;
  if (category !== undefined) post.category = category;

  res.json(post);
});
```
