# 3. 리액트에서 CURD 구현하기

## 폴더구조

```bash
src/
  api.js
  main.jsx
  App.jsx
  Layout.jsx
  pages/
    PostList.jsx
    PostView.jsx
    PostUpdate.jsx
    PostDelete.jsx
  index.css
```

## vite 프로젝트 만들기

```bash
npm create vite@latest react-curd
cd react-curd
npm i
```

## react-router-dom 설치하기

```
npm i react-router-dom
```

### main.jsx

```jsx
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import "./index.css";
import App from "./App.jsx";
import { BrowserRouter } from "react-router-dom";

createRoot(document.getElementById("root")).render(
  <StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </StrictMode>
);
```

## TailwindCSS 설치하기

```
npm i -D tailwindcss @tailwindcss/vite
```

### Vite 설정 (vite.config.js)

```js
// vite.config.js (또는 .ts)
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import tailwindcss from "@tailwindcss/vite";

export default defineConfig({
  plugins: [react(), tailwindcss()],
});
```

### index.css

```css
@import "tailwindcss";
```

## App.jsx

```jsx
import { Route, Routes } from "react-router-dom";
import Layout from "./Layout";
import PostList from "./pages/PostList";
import PostView from "./pages/PostView";
import PostCreate from "./pages/PostCreate";
import PostUpdate from "./pages/PostUpdate";
import PostDelete from "./pages/PostDelete";

export default function App() {
  return (
    <Routes>
      <Route path="/" element={<Layout />}>
        <Route index element={<PostList />} />
        <Route path="/posts/new" element={<PostCreate />} />
        <Route path="/posts/:id" element={<PostView />} />
        <Route path="/posts/:id/edit" element={<PostUpdate />} />
        <Route path="/posts/:id/delete" element={<PostDelete />} />
      </Route>
    </Routes>
  );
}
```

### 라우트 구조

- **/** → PostList (전체 목록)

- **/posts/new** → PostCreate (생성)

- **/posts/:id** → PostView (단건 보기)

- **/posts/:id/edit** → PostUpdate (수정)

- **/posts/:id/delete** → PostDelete (삭제 확인)

## Layout.jsx

```jsx
import { Link, Outlet } from "react-router-dom";

export default function Layout() {
  return (
    <div className="min-h-screen bg-gray-50 text-gray-900">
      <header className="border-b bg-white">
        <div className="mx-auto max-w-3xl px-4 py-3 flex items-center justify-between">
          <Link to="/" className="text-xl font-bold">
            Posts
          </Link>
          <Link
            to="/posts/new"
            className="rounded bg-black px-3 py-1 text-white"
          >
            New
          </Link>
        </div>
      </header>

      <main className="mx-auto max-w-3xl px-4 py-6">
        <Outlet />
      </main>
    </div>
  );
}
```

## api.js

```js
// src/api.js
const BASE_URL = "http://localhost:4000";

export async function requestAPI(path, { method = "GET", body, headers } = {}) {
  const res = await fetch(`${BASE_URL}${path}`, {
    method,
    headers: { "Content-Type": "application/json", ...(headers || {}) },
    body: body ? JSON.stringify(body) : undefined,
  });

  if (!res.ok) {
    const msg = await res.text().catch(() => res.statusText);
    throw new Error(`[${res.status}] ${msg}`);
  }

  const text = await res.text(); // 204 같은 빈 응답 대비
  return text ? JSON.parse(text) : null;
}
```

## pages/ PostList

```jsx
import { useEffect, useState } from "react";
import { Link } from "react-router-dom";
import { requestAPI } from "../api";

export default function PostList() {
  const [posts, setPosts] = useState([]);
  const [loading, setLoading] = useState(true);
  const [err, setErr] = useState("");

  useEffect(() => {
    (async function load() {
      try {
        const list = await requestAPI("/posts");
        setPosts(list);
      } catch (e) {
        setErr(e.message);
      } finally {
        setLoading(false);
      }
    })();
  }, []);

  if (loading) return <div className="text-gray-500">Loading...</div>;
  if (err) return <div className="text-red-600">Error: {err}</div>;

  return (
    <div className="space-y-3">
      {posts.length === 0 && <div className="text-gray-500">No posts.</div>}
      {posts.map((p) => (
        <div key={p.id} className="rounded-lg border bg-white p-4">
          <div className="flex items-center justify-between">
            <Link
              to={`/posts/${p.id}`}
              className="text-lg font-semibold hover:underline"
            >
              {p.title}
            </Link>
            <div className="text-xs text-gray-500">{p.category}</div>
          </div>
          <p className="mt-1 line-clamp-2 text-gray-600">{p.content}</p>
          <div className="mt-3 flex gap-2">
            <Link
              to={`/posts/${p.id}`}
              className="rounded border px-2 py-1 text-sm"
            >
              View
            </Link>
            <Link
              to={`/posts/${p.id}/edit`}
              className="rounded border px-2 py-1 text-sm"
            >
              Edit
            </Link>
            <Link
              to={`/posts/${p.id}/delete`}
              className="rounded border px-2 py-1 text-sm text-red-600"
            >
              Delete
            </Link>
          </div>
        </div>
      ))}
    </div>
  );
}
```

## pages/ PostView

```jsx
import { useEffect, useState } from "react";
import { Link, useParams } from "react-router-dom";
import { requestAPI } from "../api";

export default function PostView() {
  const { id } = useParams();
  const [post, setPost] = useState(null);
  const [loading, setLoading] = useState(true);
  const [err, setErr] = useState("");

  useEffect(() => {
    (async function load() {
      try {
        const one = await requestAPI(`/posts/${id}`);
        setPost(one);
      } catch (e) {
        setErr(e.message);
      } finally {
        setLoading(false);
      }
    })();
  }, [id]);

  if (loading) return <div className="text-gray-500">Loading...</div>;
  if (err) return <div className="text-red-600">Error: {err}</div>;
  if (!post) return <div className="text-gray-500">Not found.</div>;

  return (
    <article className="rounded-lg border bg-white p-5">
      <header className="flex items-center justify-between">
        <h1 className="text-2xl font-bold">{post.title}</h1>
        <span className="text-sm text-gray-500">{post.category}</span>
      </header>
      <p className="mt-3 whitespace-pre-wrap">{post.content}</p>

      <div className="mt-6 flex gap-2">
        <Link
          to={`/posts/${post.id}/edit`}
          className="rounded bg-blue-600 px-3 py-1 text-white"
        >
          Edit
        </Link>
        <Link
          to={`/posts/${post.id}/delete`}
          className="rounded bg-red-600 px-3 py-1 text-white"
        >
          Delete
        </Link>
        <Link to="/" className="ml-auto text-gray-600 hover:underline">
          Back
        </Link>
      </div>
    </article>
  );
}
```

## pages/ PostCreate

```jsx
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { requestAPI } from "../api";

export default function PostCreate() {
  const nav = useNavigate();
  const [form, setForm] = useState({ title: "", content: "", category: "" });
  const [saving, setSaving] = useState(false);

  const onChange = (e) => {
    const { name, value } = e.target;
    setForm((p) => ({ ...p, [name]: value }));
  };

  const onSubmit = async (e) => {
    e.preventDefault();
    setSaving(true);
    try {
      const created = await requestAPI("/posts", {
        method: "POST",
        body: form,
      });
      nav(`/posts/${created.id}`);
    } catch (e) {
      alert(e.message);
    } finally {
      setSaving(false);
    }
  };

  return (
    <form
      onSubmit={onSubmit}
      className="mx-auto max-w-2xl space-y-4 rounded-lg border bg-white p-5"
    >
      <h2 className="text-xl font-semibold">New Post</h2>

      <div>
        <label className="mb-1 block text-sm text-gray-700">Title</label>
        <input
          name="title"
          value={form.title}
          onChange={onChange}
          required
          className="w-full rounded border px-3 py-2 outline-none focus:ring"
          placeholder="제목"
        />
      </div>

      <div>
        <label className="mb-1 block text-sm text-gray-700">Category</label>
        <input
          name="category"
          value={form.category}
          onChange={onChange}
          required
          className="w-full rounded border px-3 py-2 outline-none focus:ring"
          placeholder="예: js, life"
        />
      </div>

      <div>
        <label className="mb-1 block text-sm text-gray-700">Content</label>
        <textarea
          name="content"
          value={form.content}
          onChange={onChange}
          required
          rows={8}
          className="w-full rounded border px-3 py-2 outline-none focus:ring"
          placeholder="내용"
        />
      </div>

      <div className="flex items-center gap-2">
        <button
          type="submit"
          disabled={saving}
          className="rounded bg-black px-4 py-2 text-white disabled:opacity-60"
        >
          {saving ? "Saving..." : "Publish"}
        </button>
        <button
          type="button"
          onClick={() => history.back()}
          className="rounded px-4 py-2 border"
        >
          Cancel
        </button>
      </div>
    </form>
  );
}
```

## pages/ PostUpdate

```jsx
// src/pages/PostUpdate.jsx
import { useEffect, useState } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { requestAPI } from "../api";

export default function PostUpdate() {
  const { id } = useParams();
  const nav = useNavigate();

  const [form, setForm] = useState({ title: "", content: "", category: "" });
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [err, setErr] = useState("");

  useEffect(() => {
    (async function load() {
      try {
        const one = await requestAPI(`/posts/${id}`);
        setForm({
          title: one?.title ?? "",
          content: one?.content ?? "",
          category: one?.category ?? "",
        });
      } catch (e) {
        setErr(e.message);
      } finally {
        setLoading(false);
      }
    })();
  }, [id]);

  const onChange = (e) => {
    const { name, value } = e.target;
    setForm((p) => ({ ...p, [name]: value }));
  };

  const onSubmit = async (e) => {
    e.preventDefault();
    setSaving(true);
    try {
      await requestAPI(`/posts/${id}`, { method: "PUT", body: form });
      nav(`/posts/${id}`);
    } catch (e) {
      alert(e.message);
    } finally {
      setSaving(false);
    }
  };

  if (loading) return <div className="text-gray-500">Loading...</div>;
  if (err) return <div className="text-red-600">Error: {err}</div>;

  return (
    <form
      onSubmit={onSubmit}
      className="mx-auto max-w-2xl space-y-4 rounded-lg border bg-white p-5"
    >
      <h2 className="text-xl font-semibold">Edit Post</h2>

      <div>
        <label className="mb-1 block text-sm text-gray-700">Title</label>
        <input
          name="title"
          value={form.title}
          onChange={onChange}
          required
          className="w-full rounded border px-3 py-2 outline-none focus:ring"
          placeholder="제목"
        />
      </div>

      <div>
        <label className="mb-1 block text-sm text-gray-700">Category</label>
        <input
          name="category"
          value={form.category}
          onChange={onChange}
          required
          className="w-full rounded border px-3 py-2 outline-none focus:ring"
          placeholder="예: js, life"
        />
      </div>

      <div>
        <label className="mb-1 block text-sm text-gray-700">Content</label>
        <textarea
          name="content"
          value={form.content}
          onChange={onChange}
          required
          rows={8}
          className="w-full rounded border px-3 py-2 outline-none focus:ring"
          placeholder="내용"
        />
      </div>

      <div className="flex items-center gap-2">
        <button
          type="submit"
          disabled={saving}
          className="rounded bg-black px-4 py-2 text-white disabled:opacity-60"
        >
          {saving ? "Saving..." : "Update"}
        </button>
        <button
          type="button"
          onClick={() => history.back()}
          className="rounded px-4 py-2 border"
        >
          Cancel
        </button>
      </div>
    </form>
  );
}
```

## pages/ PostDelete

```jsx
// src/pages/PostDelete.jsx
import { useEffect, useState } from "react";
import { useNavigate, useParams, Link } from "react-router-dom";
import { requestAPI } from "../api";

export default function PostDelete() {
  const { id } = useParams();
  const nav = useNavigate();
  const [post, setPost] = useState(null);
  const [loading, setLoading] = useState(true);
  const [deleting, setDeleting] = useState(false);
  const [err, setErr] = useState("");

  useEffect(() => {
    (async function load() {
      try {
        const one = await requestAPI(`/posts/${id}`);
        setPost(one);
      } catch (e) {
        setErr(e.message);
      } finally {
        setLoading(false);
      }
    })();
  }, [id]);

  const handleDelete = async () => {
    if (!confirm("정말 삭제하시겠습니까?")) return;
    setDeleting(true);
    try {
      await requestAPI(`/posts/${id}`, { method: "DELETE" });
      nav("/");
    } catch (e) {
      alert(e.message);
    } finally {
      setDeleting(false);
    }
  };

  if (loading) return <div className="text-gray-500">Loading...</div>;
  if (err) return <div className="text-red-600">Error: {err}</div>;
  if (!post) return <div className="text-gray-500">Not found.</div>;

  return (
    <div className="rounded-lg border bg-white p-5">
      <h2 className="text-xl font-semibold">삭제 확인</h2>
      <p className="mt-2 text-gray-700">다음 글을 삭제합니다:</p>
      <div className="mt-3 rounded border p-3">
        <div className="font-semibold">{post.title}</div>
        <div className="text-sm text-gray-500">{post.category}</div>
        <p className="mt-2 text-gray-700 whitespace-pre-wrap">{post.content}</p>
      </div>

      <div className="mt-4 flex gap-2">
        <button
          onClick={handleDelete}
          disabled={deleting}
          className="rounded bg-red-600 px-3 py-1 text-white disabled:opacity-60"
        >
          {deleting ? "Deleting..." : "Delete"}
        </button>
        <Link to={`/posts/${id}`} className="rounded border px-3 py-1">
          Cancel
        </Link>
      </div>
    </div>
  );
}
```
